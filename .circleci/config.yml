version: 2
jobs:
  build_main_deb:
    docker:
      - image: foundationdb/foundationdb-build:latest

    steps:
      - run:
          name: update git version
          command: |
            yum install -y http://opensource.wandisco.com/centos/6/git/x86_64/wandisco-git-release-6-1.noarch.rpm
            yum install -y git
      - checkout
      - run:
          name: get foundationdb sources
          command: |
            git clone https://github.com/apple/foundationdb.git
            git -C foundationdb checkout tags/6.1.11

      - run:
          name: configure
          command: scl enable devtoolset-8 python27 rh-python36 rh-ruby24 -- bash -c 'cmake -DINSTALL_LAYOUT=DEB foundationdb'

      - run:
          name: compile
          command: scl enable devtoolset-8 python27 rh-python36 rh-ruby24 -- bash -c 'make'

      - run:
          name: make packages
          command: scl enable devtoolset-8 python27 rh-python36 rh-ruby24 -- bash -c 'cpack'

workflows:
  version: 2
  build:
    jobs:
      - build_main_deb
